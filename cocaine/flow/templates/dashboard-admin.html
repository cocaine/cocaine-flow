{% if grouped_manifests %}
    <div class="well well-small">
    <h3>Manifests
        <small>({{ grouped_manifests|length }})</small>
    </h3>
    </div>
    <table class="table table-bordered">
        {% for app_name, common_manifest_dict in grouped_manifests.items() %}
            <tr>
                <td>
                    <div>
                        <a data-target="#versions_{{ app_name|replace(" ","_")}}" data-toggle='collapse'>
                           <strong> {{ app_name}} </strong>
                        </a>
                        <small>({{ common_manifest_dict['manifests']|length }})</small>
                        - {{ common_manifest_dict['description'] }} -
                        <em>{{ common_manifest_dict['type'] }}</em>
                    </div>
                    <div id="versions_{{ app_name|replace(" ","_")}}" class="collapse">
                        {% for manifest in common_manifest_dict['manifests'] %}

                            <dl>
                                <hr>

                                <dt>
                                    <h4> {{ manifest.uuid }}

                                    {% if user.admin %}
                                        <span class="pull-right">
                                            <button type="button" class="btn btn-mini deploy"
                                                    data-uuid="{{ manifest.uuid }}">
                                                Deploy
                                            </button>

                                        <button type="button" class="btn btn-danger btn-mini remove"
                                                data-id="{{ manifest.uuid }}">Remove
                                        </button>
                                    </span>
                                    {% endif %}
                                    </h4>

                                </dt>
                                <dd>

                                    {% if manifest.url %}
                                        <dl>
                                            <dt>Cloned from</dt>
                                            <dd> <a href="{{ manifest.git_to_html_url }}"> {{ manifest.url }} </a></dd>
                                        </dl>
                                    {% endif %}

                                    <dl>
                                        <dt>Developer</dt>
                                        <dd>{{ manifest.developer_username }}</dd>
                                    </dl>

                                    {% if manifest.depends %}
                                        <dl>
                                            <dt>Dependencies</dt>
                                            {% for depends in manifest.depends %}
                                                <dd>{{ depends }}</dd>
                                            {% endfor %}
                                        </dl>
                                    {% endif %}

                                    {% if manifest.drivers %}
                                        <dl>
                                            <dt>Drivers</dt>
                                            {% for alias, settings in manifest.drivers.items() %}
                                                <dd>
                                                          {{ alias }}
                                                    <pre>{{ settings|pprint }}</pre>
                                                </dd>
                                            {% endfor %}
                                        </dl>
                                    {% endif %}


                                    {% if manifest.args %}
                                        <dl>
                                            <dt>Args</dt>
                                            <dd>{{ manifest.args|pprint }}</dd>
                                        </dl>
                                    {% endif %}

                                    {% if manifest.changelog %}

                                        <dl>
                                            <dt>Changelog</dt>
                                            {% for change in manifest.changelog %}
                                                {% set change_info = change.split() %}
                                                <dd>
                                                <div class="span2">{{ change_info[0] }}</div>
                                                <div class="span2">{{ change_info[1] }}</div>
                                                <div class="span8">{{ change_info[2:]|join(" ") }}</div>
                                                </dd>
                                            {% endfor %}
                                        </dl>
                                    {% endif %}

                                    {% if manifest.structure %}
                                        {# <dl>
                                            <dt>Structure</dt>
                                            {% for record in manifest.structure %}
                                                <dd>{{ record }}</dd>
                                            {% endfor %}
                                        </dl>
                                    #}
                                    <div class="accordion-heading" >
                                        <a class="accordion-toggle" data-toggle="collapse" href="#Structure_{{manifest.uuid|replace(" ","_")}}"><h5>Structure</h5></a>
                                    </div>
                                    <div id="Structure_{{manifest.uuid|replace(" ","_")}}" class="accordion-body collapse">
                                        <div class="accordion-inner">
                                            <dl>
                                            {% for record in manifest.structure %}
                                                <dd> {{record}}</dd>
                                            {% endfor %}
                                            </dl>
                                        </div>
                                    </div>

                                    {% endif %}


                                </dd>
                            </dl>
                        {% endfor %}

                    </div>
                </td>
            </tr>
        {% endfor %}
    </table>
{% else %}
    <h3>No manifests</h3>
{% endif %}

    <div class="well well-small">
    <h3>Runlists
        <small>({{ runlists|length }})</small>
        {% if user.admin%}
        <a href="#ModalRemoveRunlist" role="button" class="span2 pull-right btn btn-danger" data-toggle="modal">Remove runlist</a>
        <a href="#ModalAddRunlist" role="button" class="span2 pull-right btn btn-success" data-toggle="modal">Add runlist</a>
        {% endif %}
    </h3>
    </div>
{% if runlists %}
    <table class="table table-bordered runlists">
        <thead>
        <tr>
            <th class="muted">Name</th>
            <th class="muted">Apps-Profiles</th>
        </tr>
        </thead>

        {% for runlist_name, runlist in runlists.items() %}
            <tr>
                <td>
                             <strong class="span2 text-info">{{ runlist_name }}</strong>
                </td>
                <td>
                    {% for app_name, profile_name in runlist.items() %}
                        <div class="clearfix runlist">
                                <span class="pull-left">
                                    <strong>{{ app_name }} - <span class="edit select text-success" >{{ profile_name }}</strong></span>
                                </span>
                            <button type="button" class="pull-right undeploy btn btn-danger btn-mini"
                               data-url="{{ runlist_name }}/{{ app_name }}/{{ profile_name }}">Undeploy</button>
                        </div>
                    {% endfor %}
                </td>
            </tr>
        {% endfor %}
    </table>
{% else %}
    <h3>No runlists</h3>
{% endif %}

    <div class="well well-small">
    <h3>Profiles
        <small>({{ profiles|length }})</small>
        {% if user.admin %}
        <a href="#ModalRemoveProfile" role="button" class="span2 pull-right btn btn-danger" data-toggle="modal">Remove profile</a>
        <a href="#ModalAddProfile" role="button" class="span2 pull-right btn btn-success" data-toggle="modal">Add profile</a>
        {% endif %}
    </h3>
    </div>
{% if profiles %}
    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Name</th>
            <th>Config</th>
        </tr>
        </thead>

        {% for profile_name, profile in profiles.items() %}
            <tr>
                <td><strong class="text-info">{{ profile_name }}</strong></td>
                <td>
                    <ul class="unstyled">
                        {% for option, value in profile|dictsort %}
                            <li>
                                {{ option }} - <span class="edit text-info"
                                                     id="profile:{{ profile_name }}:{{ option }}:{{ value }}">{{ value }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                </td>
            </tr>
        {% endfor %}
    </table>
{% else %}
    <h3>No profiles</h3>
{% endif %}

{% if user.admin %}
<div class="well well-small">
                <h3 >Hosts
                        <a href="#ModalAddHost" role="button" class="pull-right btn btn-success" data-toggle="modal">Add host</a>
                </h3>
        </div>
<div >
{% if hosts %}
{% for alias, hosts in hosts.items() %}
    <div class="accordion-group">
        <div class="AAAA" my-target="hosts_{{alias}}">
                            <div class="row">
                                   <div class="span4"><strong class="text-info">&nbsp{{ alias }}</strong></div>
                                   <button type="button" class="pull-right remove_alias btn btn-danger btn-mini"
                                                    data-alias="{{alias}}">
                                                    Remove cluster
                                    </button>
                                  
                            </div>
        </div>
    </div>
        <div id="hosts_{{ alias }}" class="collapse">
                    <div class="tabbabel tabs-left">
                        <ul class="nav nav-tabs">
                            {% for host in hosts %}
                                {% if loop.first%}
                                    <li data-host="{{alias}}:{{host}}" data-target-panel="tab_pane{{alias}}{{loop.index0}}" class="active info_host">
                                        <a href="#{{alias}}{{loop.index0}}_tab" data-toggle="tab"><h5>{{host}}</h5></a>
                                    </li>
                                {% else %}
                                    <li data-host="{{alias}}:{{host}}" data-target-panel="tab_pane{{alias}}{{loop.index0}}" class="info_host">
                                            <a href="#{{alias}}{{loop.index0}}_tab" data-toggle="tab" ><h5>{{host}}</h5></a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            </ul>
                        <div class="tab-content">
                            {% for host in hosts %}
                                {% if loop.first%}
                                    <div class="tab-pane active" id="{{alias}}{{loop.index0}}_tab">
                                {% else %}
                                    <div class="tab-pane" id="{{alias}}{{loop.index0}}_tab">
                                {% endif %}
                                        <p>&nbsp</p>
                                        <strong>Some information about {{host}}</strong>
                                            <span class="pull-right">
                                                <button type="button" class="info_host btn btn-info btn-mini"
                                                        data-host="{{alias}}:{{host}}" data-target-panel="tab_pane{{alias}}{{loop.index0}}">
                                                     Refresh
                                                </button>

                                                <button type="button" class="remove_host btn btn-danger btn-mini"
                                                        data-host="{{alias}}:{{host}}"> 
                                                        Remove
                                                </button>
                                            </span>
                                        <p>&nbsp</p>
                                        <div class="tab_pane" id="tab_pane{{alias}}{{loop.index0}}">
                                        </div>
                                    </div>
                            {% endfor %}
                        </div>
                    </div>
        </div>
{% endfor %}
</div>
<!-- ENDTEST -->
{% else %}
    <h3>No hosts</h3>
{% endif %}
{% endif %}

<!-- Modal window for add host -->

<div id="ModalAddHost" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 class="muted">Specify name of cluster and hostname </h3>
</div>
<form class="form-search">
<p>&nbsp</p>
    <div class="span2"> 
        <label class="control-label" for="url">
            <p class="text-success"><h4>Cluster</h4></p>
            <p class="text-success"><h4>Hostname</h4></p>
        </label>
    </div>
    <div class="control-group">
        <div class="controls">
            <input type="text" name="url" placeholder="mycluster" id="alias_name_for_add" class="input alias_name_for_add">
            <input type="text" name="url" placeholder="example.host.net" id="host_name_for_add" class="input host_name_for_add">
        </div>
    </div>
</form>
<div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <button class="btn btn-primary add_host">Add host</button>
</div>
</div>
<!-- END -->

<!-- Modal window for add profile -->
<div id="ModalAddProfile" class="modal hide fade" aria-hidden="true" role="dialog" tabindex="-1" >
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 class="muted">Specify options</h3>
    </div>

    <div class="modal-body">
        <div class="row">
            <div class="span4">
                <div class="row">
                    <div class="span2"><strong>Profile name</strong></div> 
                    <input class="span2" type="number" id="Profile-name" min="1" required>
                </div>
    {% for OPTION in PROFILE_OPTIONS %}
            <div class="row">
                <div class="span2"><strong>{{OPTION}}</strong></div> 
                <input class="span2 offset1" type="number" id="{{OPTION}}" min="1">
            </div>
    {%endfor %}
    </div>
    <div class="span2">
        <blockquote class="pull-right">
            <p class="text-info">Please specify the parameters that you are interested and the name of the profile</p>
        </blockquote>
        <div id="profile-msg">
        </div>
    </div>
    </div>
</div>
<div class="modal-footer">
    <button class="btn btn-primary" id="Profile_OK_button">OK</button>
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
</div>
</div>
<!-- END OF ADD PROFILE -->
<!-- Remove modal -->
<div id="ModalRemoveProfile" class="modal hide fade" aria-hidden="true" role="dialog" tabindex="-1" >
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel" class="muted">Specify runlist name</h3>
    </div>
        
        <div class="modal-body">
            <div class="row">
                <div class="span4" >
                    <p>
                            <select id="profile_select" name="profile_select">
     {% for profile in profiles.keys() %} 
                            <option>{{profile}}</option>
     {% endfor %}
                        </select>
                    </p>
                </div>
            </div>
        </div>

    <div class="modal-footer">
        <button class="btn btn-primary btn-danger profile_remove" id="Profile_OK_button">Delete</button>
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>
<!-- END -->

<!-- Modal window for add runlist -->
<div id="ModalAddRunlist" class="modal hide fade" aria-hidden="true" role="dialog" tabindex="-1" >
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel" class="muted">Enter runlist name</h3>
    </div>
        
        <div class="modal-body">
            <div class="row">
                <div class="span4">
                    <input type="text" id="Runlist-name" placeholder="MyRunlistName">
                </div>
            </div>
        </div>

    <div class="modal-footer">
        <button class="btn btn-primary" id="Runlist_OK_button">OK</button>
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>
<!-- END -->
<!-- Remove modal -->
<div id="ModalRemoveRunlist" class="modal hide fade" aria-hidden="true" role="dialog" tabindex="-1" >
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel" class="muted">Specify runlist name</h3>
    </div>
        
        <div class="modal-body">
            <div class="row">
                <div class="span4" >
                    <p>
                            <select id="runlist_select" name="runlist_select">
     {% for runlist_name, profile in runlists.items() %} 
                            <option>{{runlist_name}}</option>
     {% endfor %}
                        </select>
                    </p>
                </div>
            </div>
        </div>

    <div class="modal-footer">
        <button class="btn btn-primary btn-danger runlist_remove" id="Runlist_OK_button">Delete</button>
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>
<!-- END -->

{% if user.admin %}
    {% block js %}
        <script type="text/javascript" src="{{ url_for('static', filename='bootbox.min.js') }}"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.7.0/dojo/dojo.js"
            type="text/javascript"></script>

        <script type="text/javascript">
            $(document).ready(function ()
                              {
                                  var profile_options = {{PROFILE_OPTIONS|safe}};
                                        var schema = {
                                            "type" : "object",
                                            "properties" : {
                                                'grow-threshold': {
                                                    "type" : "number",
                                                    "optional" : true
                                                },
                                                'heartbeat-timeout': {
                                                    "type" : "number",
                                                    "optional" : true
                                                },
                                                'idle-timeout': {
                                                    "type" : "number",
                                                    "optional" : true
                                                },
                                                'pool-limit': {
                                                    "type" : "number",
                                                    "optional" : true
                                                },
                                                'startup-timeout': {
                                                    "type" : "number",
                                                    "optional" : true
                                                },
                                                'termination-timeout': {
                                                    "type" : "number",
                                                    "optional" : true
                                                }
                                            }
                                    }
                                  $('.profile_remove').click(
                                    function (){
                                            var profile_name = $("#profile_select :selected").html();
                                            
                                              bootbox.confirm("Do u really want to remove?", "No", "Yes", function (result)
                                              {
                                                  if (result)
                                                  {
                                            
                                                      $.ajax({
                                                                 url:'/profiles/'+ profile_name,
                                                                 type:"DELETE",
                                                                 success:function (data, textStatus, jqXHR)
                                                                 {
                                                                    bootbox.alert(jqXHR.responseText, function(){
                                                                    location.reload(true);
                                                                 });
                                                                 },
                                                                 error:function (jqXHR, textStatus, errorThrown)
                                                                 {
                                                                    bootbox.alert(jqXHR.responseText, function(){
                                                                    location.reload(true);
                                                                 });
                                                                 }       
                                                             });
                                                    }
                                                });

                                    }
                                  );
                                  $('.runlist_remove').click(
                                    function (){
                                            var runlist_name = $("#runlist_select :selected").html();
                                            
                                              bootbox.confirm("Do u really want to remove?", "No", "Yes", function (result)
                                              {
                                                  if (result)
                                                  {
                                            
                                                      $.ajax({
                                                                 url:'/runlists/'+ runlist_name,
                                                                 type:"DELETE",
                                                                 success:function (data, textStatus, jqXHR)
                                                                 {
                                                                    bootbox.alert(jqXHR.responseText, function(){
                                                                    location.reload(true);
                                                                 });
                                                                 },
                                                                 error:function (jqXHR, textStatus, errorThrown)
                                                                 {
                                                                    bootbox.alert(jqXHR.responseText, function(){
                                                                    location.reload(true);
                                                                 });
                                                                 }       
                                                             });
                                                    }
                                                });

                                    }
                                  );
                                  $('#Runlist_OK_button').click(
                                    function() {
                                        var runlist_name = $('#Runlist-name').val();
                                        if (runlist_name == ''){
                                            return
                                        }
                                                      $.ajax({
                                                                 url:'/runlists/'+ runlist_name,
                                                                 type:"POST",
                                                                 success:function (data, textStatus, jqXHR)
                                                                 {
                                                                    bootbox.alert(jqXHR.responseText, function(){
                                                                    location.reload(true);
                                                                 });
                                                                 },
                                                                 error:function (jqXHR, textStatus, errorThrown)
                                                                 {
                                                                    bootbox.alert(jqXHR.responseText, function(){
                                                                    location.reload(true);
                                                                 });
                                                                 }       
                                                             });
                                    }
                                  );
                                  $('#Profile_OK_button').click(
                                    function(){
                                        json_object = {};
                                        for (y in profile_options){
                                            var tmp = $('#'+profile_options[y]).val()
                                            if (tmp != '' ){
                                                value = parseInt(tmp)
                                                if (value){
                                                    json_object[profile_options[y]] = value;
                                                }
                                                else
                                                {   
                                                    alert("Wrong type: need number" + profile_options[y]);
                                                    $('#profile-msg').html("<p class='text-error'> ERROR!</p>");
                                                    return
                                                }
                                            }
                                        }
                                        var profile_name = $('#Profile-name').val();
                                        if ((json_object != {}) & (profile_name != ''))
                                            {
                                                require(["dojox/json/schema"],function()
                                                {
                                                    var result = dojox.json.schema.validate(json_object, schema);
                                                    if (!result.valid)
                                                    {   
                                                        //alert("ok");
                                                        return
                                                    }
                                                })
                                            }
                                        $.ajax({
                                                url:    '/profiles/' + profile_name,
                                                type:   "POST",
                                                data:   JSON.stringify(json_object),
                                                dataType: 'json',
                                                contentType : 'application/json',
                                                success:function (data, textStatus, jqXHR)
                                                                 {
                                                                    bootbox.alert(jqXHR.responseText, function(){
                                                                    location.reload(true);
                                                                 });
                                                                 },
                                                                 error:function (jqXHR, textStatus, errorThrown)
                                                                 {
                                                                    bootbox.alert(jqXHR.responseText, function(){
                                                                    location.reload(true);
                                                                 });
                                                                 }       
                                                             });
                                  }
                                  )
                                  $('.AAAA').click(
                                    function()
                                    {
                                        var target = $(this).attr('my-target');
                                        $('#'+target).collapse('toggle');
                                    }
                                  );

                                  $('.info_host').click(
                                    function ()
                                    {
                                       var target = $(this).attr('data-host').split(':');
                                       var panel = $(this).attr('data-target-panel');
                                                      $.ajax({
                                                                 url:'/stats/'+ target[0] + '/' + target[1] ,
                                                                 type:"GET",
                                                                 success:function (data, textStatus, jqXHR)
                                                                 {
                                                                    if (data != 'None'){
                                                                        $('#'+panel).html('<pre>'+JSON.stringify(data, undefined,1) + '</pre>');
                                                                    }
                                                                    else {
                                                                        $('#'+panel).html('<pre>Not available</pre>');
                                                                    }
                                                                 },
                                                                 error:function (jqXHR, textStatus, errorThrown)
                                                                 {
                                                                    bootbox.alert(jqXHR.responseText, function(){
                                                                    location.reload(true);
                                                                 });
                                                                 }       
                                                             });
                                    }
                                  );
                                  $('.remove').click(
                                          function ()
                                          {
                                              var app_id = $(this).attr('data-id');
                                              var btn = $(this);
                                              bootbox.confirm("Are you sure?", "No", "Yes", function (result)
                                              {
                                                  if (result)
                                                  {
                                                      $.ajax({
                                                                 url:'/app/' + app_id,
                                                                 type:"DELETE",
                                                                 success:function (data, textStatus, jqXHR)
                                                                 {
                                                                     btn.parents('dl').remove();
                                                                 }
                                                             });
                                                  }
                                              });
                                          });

                                  function create_select(entities, title)
                                  {
                                      var s = "<div class='control-group'>" +
                                                "<label class='control-label'>" + title +
                                                ":</label>" +
                                                "<div class='controls'>" +
                                                    "<select class='span2' name='" + title + "'>" +
                                                "</div>" +
                                              "</div>";
                                      for (var index in entities)
                                      {
                                          s += "<option value='" + entities[index] + "'>" + entities[index] + "</option>";
                                      }
                                      s += "</select>";
                                      console.log(s);
                                      return s;
                                  }

                                  $('.remove_host').click(
                                          function ()
                                          {
                                              var alias_host = $(this).attr('data-host').split(':');
                                              bootbox.confirm("Do u really want to remove?", "No", "Yes", function (result)
                                              {
                                                  if (result)
                                                  {
                                                            $.ajax({
                                                                    url:'/hosts/'+ alias_host[0] + '/' + alias_host[1],
                                                                    type:"DELETE",
                                                                    success:function (data, textStatus, jqXHR)
                                                                    {
                                                                        bootbox.alert("Host:" + alias_host + "is removed succesfully!", function(){
                                                                            location.reload(true);
                                                                        });
                                                                    },
                                                                    error:function (jqXHR, textStatus, errorThrown)
                                                                    {
                                                                        bootbox.alert(jqXHR.responseText, function(){
                                                                        location.reload(true);
                                                                    });
                                                                    }       
                                                                });
                                                  }
                                              });

                                          }
                                  );

                                  $('.remove_alias').click(
                                          function ()
                                          {
                                              var alias = $(this).attr('data-alias');
                                              bootbox.confirm("Do u really want to remove?", "No", "Yes", function (result)
                                              {
                                                  if (result)
                                                  {
                                                            $.ajax({
                                                                    url:'/hosts/'+ alias,
                                                                    type:"DELETE",
                                                                    success:function (data, textStatus, jqXHR)
                                                                    {
                                                                        bootbox.alert("Cluster " + alias + "is removed succesfully!", function(){
                                                                            location.reload(true);
                                                                        });
                                                                    },
                                                                    error:function (jqXHR, textStatus, errorThrown)
                                                                    {
                                                                        bootbox.alert(jqXHR.responseText, function(){
                                                                        location.reload(true);
                                                                    });
                                                                    }       
                                                                });
                                                  }
                                              });

                                          }
                                  );

                                  $('.add_host').click(
                                            function ()
                                            {
                                                var hostname = $('.host_name_for_add').val();
                                                var alias = $('.alias_name_for_add').val();
                                                if ((alias == '' ) | ( hostname == ''))
                                                {   
                                                    return
                                                }
                                                
                                                $.ajax({
                                                            url:'/hosts/'+ alias + '/' + hostname,
                                                            type:"POST",
                                                            success:function (data, textStatus, jqXHR)
                                                            {
                                                                bootbox.alert("Host is added succesfully!", function(){
                                                                location.reload(true);
                                                                });
                                                            },
                                                            error:function (jqXHR, textStatus, errorThrown)
                                                            {
                                                                bootbox.alert(jqXHR.responseText, function(){
                                                                        location.reload(true);
                                                                });
                                                            }
                                            });
                                    }
                                  );

                                  $('.deploy').click(
                                          function ()
                                          {
                                              var uuid = $(this).attr('data-uuid');
                                              var btn = $(this);
                                              var str = $("<span>Loading...</span>");
                                              $.getJSON('/runlists', function (runlists)
                                              {
                                                  $.getJSON('/profiles', function (profiles)
                                                  {
                                                      str.html(create_select(runlists, "Runlist") + create_select(profiles, "Profile"));
                                                  });
                                              });

                                              bootbox.confirm(str, "No", "Yes", function (result)
                                              {
                                                  if (result)
                                                  {
                                                      var runlist = $("select[name=Runlist]", str).val();
                                                      var profile = $("select[name=Profile]", str).val();
                                                      console.log(runlist);
                                                      console.log(profile);
                                                      $.ajax({
                                                                 url:'/deploy/' + runlist + '/' + uuid + '/' + profile,
                                                                 type:"POST",
                                                                 success:function (data, textStatus, jqXHR)
                                                                 {
                                                                     bootbox.alert("Application is deployed");
                                                                 },
                                                                 error:function (jqXHR, textStatus, errorThrown)
                                                                 {
                                                                     bootbox.alert(jqXHR.responseText, function(){
                                                                         location.reload(true);
                                                                     });
                                                                 }
                                                             });

                                                  }
                                              });
                                          });


                                  $('.undeploy').click(
                                          function ()
                                          {
                                              var url = $(this).attr('data-url');
                                              var btn = $(this);
                                              bootbox.confirm("Are you sure?", "No", "Yes", function (result)
                                              {
                                                  if (result)
                                                  {
                                                      $.ajax({
                                                                 url:'/undeploy/' + url,
                                                                 type:"POST",
                                                                 success:function (data, textStatus, jqXHR)
                                                                 {
                                                                     btn.parents('div.runlist').remove();
                                                                     bootbox.alert("Application is undeployed");
                                                                 },
                                                                 error:function (jqXHR, textStatus, errorThrown)
                                                                 {
                                                                     bootbox.alert(jqXHR.responseText, function(){
                                                                         location.reload(true);
                                                                     });
                                                                 }
                                                             });

                                                  }
                                              });
                                          });


                                  $('.edit.text-info').editable('/dashboard/edit', {
                                      style:'display: inline',
                                      tooltip:'Click to edit...'
                                  });

                                  $('.edit.select').editable('/dashboard/edit', {
                                      style:'display: inline',
                                      loadurl:'/profiles',
                                      type:'select',
                                      cssclass:'form-horizontal',
                                      loaddata:{view:'dict'},
                                      callback:function (value, settings)
                                      {
                                          console.log(this);
                                          console.log(value);
                                          console.log(settings);
                                      }
                                  });


                              });


        </script>
    {% endblock %}
{% endif %}
